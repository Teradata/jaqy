Jaqy Console 1.0
-- 0/0 - 0 ----------------------------------------------------------------
--------------------------------------------------------------------------
-- autocommit setting test
--------------------------------------------------------------------------
.set autocommit on
-- error: Current session is closed.
-- 0/1 - 0 ----------------------------------------------------------------
.set autocommit off
-- error: Current session is closed.
-- 0/2 - 0 ----------------------------------------------------------------
.set autocommit
-- error: Current session is closed.
-- 0/3 - 0 ----------------------------------------------------------------

.run ../common/mysql_setup.sql
-- Running script: ../common/mysql_setup.sql
-- 0/4 - 0 ----------------------------------------------------------------
.open -u root mysql://localhost/?useUnicode=true&characterEncoding=utf-8
-- 0/5 - 0 ----------------------------------------------------------------
USE vagrant;
-- success. update count = 0
-- 1/5 - 0 ----------------------------------------------------------------

.set autocommit
.set autocommit true
-- 1/6 - 0 ----------------------------------------------------------------

CREATE TABLE MyTable
(
	a	INTEGER PRIMARY KEY,
	b	VARCHAR(200)
);
-- success. update count = 0
-- 2/6 - 0 ----------------------------------------------------------------

.set autocommit off
-- 2/7 - 0 ----------------------------------------------------------------
.set autocommit
.set autocommit false
-- 2/8 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (1, '1');
-- success. update count = 1
-- 3/8 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (2, '2');
-- success. update count = 1
-- 4/8 - 0 ----------------------------------------------------------------
.commit
-- 4/9 - 0 ----------------------------------------------------------------

SELECT * FROM MyTable ORDER BY a;
-- success --
a b
- -
1 1
2 2
-- activity count = 2
-- 5/9 - 0 ----------------------------------------------------------------

INSERT INTO MyTable VALUES (3, '3');
-- success. update count = 1
-- 6/9 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (4, '4');
-- success. update count = 1
-- 7/9 - 0 ----------------------------------------------------------------
.rollback
-- 7/10 - 0 ---------------------------------------------------------------

SELECT * FROM MyTable ORDER BY a;
-- success --
a b
- -
1 1
2 2
-- activity count = 2
-- 8/10 - 0 ---------------------------------------------------------------

.set autocommit on
-- 8/11 - 0 ---------------------------------------------------------------
.set autocommit
.set autocommit true
-- 8/12 - 0 ---------------------------------------------------------------

INSERT INTO MyTable VALUES (5, '5');
-- success. update count = 1
-- 9/12 - 0 ---------------------------------------------------------------
INSERT INTO MyTable VALUES (6, '6');
-- success. update count = 1
-- 10/12 - 0 --------------------------------------------------------------
.rollback
-- failure 0: [08003] Can't call rollback when autocommit=true
-- 10/13 - 0 --------------------------------------------------------------

SELECT * FROM MyTable ORDER BY a, b;
-- success --
a b
- -
1 1
2 2
5 5
6 6
-- activity count = 4
-- 11/13 - 0 --------------------------------------------------------------

DROP TABLE MyTable;
-- success. update count = 0
-- 12/13 - 0 --------------------------------------------------------------

.close
-- 12/14 - 0 --------------------------------------------------------------

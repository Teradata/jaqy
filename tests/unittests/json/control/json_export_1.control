Jaqy Console 1.2.0
-- 0/0 - 0 ----------------------------------------------------------------
--------------------------------------------------------------------------
-- .export json test
--------------------------------------------------------------------------
.run ../common/sqlite_setup.sql
-- Running script: ../common/sqlite_setup.sql
-- 0/1 - 0 ----------------------------------------------------------------
.open sqlite::memory:
-- 0/2 - 0 ----------------------------------------------------------------
.format csv
-- 0/3 - 0 ----------------------------------------------------------------

CREATE TABLE MyTable(a INTEGER PRIMARY KEY, b VARCHAR(200), c VARCHAR(200), d BLOB);
-- success. update count = 0
-- 1/3 - 0 ----------------------------------------------------------------

INSERT INTO MyTable VALUES (1, 'abc', 'def', X'deadbeef');
-- success. update count = 1
-- 2/3 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (2, 'john', 'doe', null);
-- success. update count = 1
-- 3/3 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (3, 'a"b', 'c"d', X'deadbeef');
-- success. update count = 1
-- 4/3 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (4, 'a,b', 'c,d', X'deadbeef');
-- success. update count = 1
-- 5/3 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (5, 'a''b', 'c''d', X'deadbeef');
-- success. update count = 1
-- 6/3 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (6, 'a''",b', 'c''",d', X'deadbeef');
-- success. update count = 1
-- 7/3 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (7, 'a	b', 'c,d', X'deadbeef');
-- success. update count = 1
-- 8/3 - 0 ----------------------------------------------------------------

.export json
-- error: missing file name.
-- 8/4 - 0 ----------------------------------------------------------------
.export json file1.json
-- 8/5 - 0 ----------------------------------------------------------------
.export
.export json
-- 8/6 - 0 ----------------------------------------------------------------
SELECT * FROM MyTable ORDER BY a;
-- success --
-- activity count = 7
-- 9/6 - 0 ----------------------------------------------------------------
.os cat file1.json
[{"a":1,"b":"abc","c":"def","d":"3q2+7w=="},{"a":2,"b":"john","c":"doe","d":null},{"a":3,"b":"a\"b","c":"c\"d","d":"3q2+7w=="},{"a":4,"b":"a,b","c":"c,d","d":"3q2+7w=="},{"a":5,"b":"a'b","c":"c'd","d":"3q2+7w=="},{"a":6,"b":"a'\",b","c":"c'\",d","d":"3q2+7w=="},{"a":7,"b":"a\tb","c":"c,d","d":"3q2+7w=="}]-- 9/7 - 0 ----------------------------------------------------------------

.export json -b hex file2.json
-- 9/8 - 0 ----------------------------------------------------------------
SELECT * FROM MyTable ORDER BY a;
-- success --
-- activity count = 7
-- 10/8 - 0 ---------------------------------------------------------------
.os cat file2.json
[{"a":1,"b":"abc","c":"def","d":"deadbeef"},{"a":2,"b":"john","c":"doe","d":null},{"a":3,"b":"a\"b","c":"c\"d","d":"deadbeef"},{"a":4,"b":"a,b","c":"c,d","d":"deadbeef"},{"a":5,"b":"a'b","c":"c'd","d":"deadbeef"},{"a":6,"b":"a'\",b","c":"c'\",d","d":"deadbeef"},{"a":7,"b":"a\tb","c":"c,d","d":"deadbeef"}]-- 10/9 - 0 ---------------------------------------------------------------

.export json -c utf-16le -p on file3.json
-- 10/10 - 0 --------------------------------------------------------------
.export json -c utf-16le -p on file4.json
-- 10/11 - 0 --------------------------------------------------------------
SELECT * FROM MyTable ORDER BY a;
-- success --
-- activity count = 7
-- 11/11 - 0 --------------------------------------------------------------

.export json -f bson file5.bson
-- 11/12 - 0 --------------------------------------------------------------
SELECT * FROM MyTable ORDER BY a;
-- success --
-- activity count = 7
-- 12/12 - 0 --------------------------------------------------------------

DROP TABLE MyTable;
-- success. update count = 1
-- 13/12 - 0 --------------------------------------------------------------
.close
-- 13/13 - 0 --------------------------------------------------------------

.os rm -f file?.json file?.bson
-- 13/14 - 0 --------------------------------------------------------------

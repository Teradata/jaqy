Jaqy Console 1.0
-- 0/0 - 0 ----------------------------------------------------------------
--------------------------------------------------------------------------
-- .sort command test
--------------------------------------------------------------------------
.run ../common/postgresql_setup.sql
-- Running script: ../common/postgresql_setup.sql
-- 0/1 - 0 ----------------------------------------------------------------
.open -u postgres postgresql://localhost/?stringtype=unspecified
-- 0/2 - 0 ----------------------------------------------------------------

CREATE TABLE MyTable (a INTEGER, b BYTEA, c INT[]);
-- success. update count = 0
-- 1/2 - 0 ----------------------------------------------------------------

INSERT INTO MyTable VALUES (1, E'\\xdeadbeef', '{1,2,3}');
-- success. update count = 1
-- 2/2 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (1, E'\\xdeadbeef', NULL);
-- success. update count = 1
-- 3/2 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (1, E'\\xfacefeed', '{1,2,3}');
-- success. update count = 1
-- 4/2 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (1, E'\\xface', '{2,3,4}');
-- success. update count = 1
-- 5/2 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (2, E'\\xdeadbeef', '{1,2,3}');
-- success. update count = 1
-- 6/2 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (2, NULL, '{1,2,3}');
-- success. update count = 1
-- 7/2 - 0 ----------------------------------------------------------------
INSERT INTO MyTable VALUES (2, NULL, '{1,2,3}');
-- success. update count = 1
-- 8/2 - 0 ----------------------------------------------------------------
FROM MyTable;
-- failure 0: [42601] ERROR: syntax error at or near "FROM"
  Position: 1
-- 9/2 - 0 ----------------------------------------------------------------

.sort -a 2 -a 1
-- 9/3 - 0 ----------------------------------------------------------------
SELECT * FROM MyTable ORDER BY a, b, c;
-- success --
a b c
- - -------
2 ? {1,2,3}
2 ? {1,2,3}
1 d {1,2,3}
1 d ?
2 d {1,2,3}
1 f {2,3,4}
1 f {1,2,3}
-- activity count = 7
-- 10/3 - 0 ---------------------------------------------------------------

.sort -a 3
-- 10/4 - 0 ---------------------------------------------------------------
SELECT * FROM MyTable ORDER BY a, b, c;
-- success --
a b c
- - -------
1 d ?
1 d {1,2,3}
1 f {1,2,3}
2 d {1,2,3}
2 ? {1,2,3}
2 ? {1,2,3}
1 f {2,3,4}
-- activity count = 7
-- 11/4 - 0 ---------------------------------------------------------------

DROP TABLE MyTable;
-- success. update count = 0
-- 12/4 - 0 ---------------------------------------------------------------

CREATE TABLE XmlTable (a INTEGER, b XML, c JSON);
-- success. update count = 0
-- 13/4 - 0 ---------------------------------------------------------------

INSERT INTO XmlTable VALUES (1, '<a>1234</a>', '[1,2,3]');
-- success. update count = 1
-- 14/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (1, '<a>1234</a>', '[2,3,4]');
-- success. update count = 1
-- 15/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (1, NULL, NULL);
-- success. update count = 1
-- 16/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (1, NULL, NULL);
-- success. update count = 1
-- 17/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (2, NULL, NULL);
-- success. update count = 1
-- 18/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (2, '<a>1234</a>', '[1,2,3]');
-- success. update count = 1
-- 19/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (2, '<a>1234</a>', '[2,3,4]');
-- success. update count = 1
-- 20/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (2, '<a>1234</a>', '[1,2,3]');
-- success. update count = 1
-- 21/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (2, '<a>1234</a>', '[2,3,4]');
-- success. update count = 1
-- 22/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (3, '<a>2222</a>', '[1,2,3]');
-- success. update count = 1
-- 23/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (3, '<a>3333</a>', '[2,3,4]');
-- success. update count = 1
-- 24/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (3, '<a>4444</a>', '[1,2,3]');
-- success. update count = 1
-- 25/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (3, '<a>5555</a>', '[2,3,4]');
-- success. update count = 1
-- 26/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (4, '<a>1</a>', '[2,3,4]');
-- success. update count = 1
-- 27/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (4, '<a>1</a>', '[2,3,4]');
-- success. update count = 1
-- 28/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (4, '<a>12</a>', '[2,3,4]');
-- success. update count = 1
-- 29/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (4, '<a>12</a>', '[2,3,4]');
-- success. update count = 1
-- 30/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (4, '<a>22</a>', '[2,3,4]');
-- success. update count = 1
-- 31/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (4, '<a>22</a>', '[2,3,4]');
-- success. update count = 1
-- 32/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (4, '<a>123</a>', '[2,3,4]');
-- success. update count = 1
-- 33/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (4, '<a>123</a>', '[2,3,4]');
-- success. update count = 1
-- 34/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (5, '<a>1234</a>', '[1,2,3]');
-- success. update count = 1
-- 35/4 - 0 ---------------------------------------------------------------
INSERT INTO XmlTable VALUES (5, '<a>1234</a>', '[2,3,4]');
-- success. update count = 1
-- 36/4 - 0 ---------------------------------------------------------------

-- artificially sets the cache size to be very small for testing purposes.
.script
interpreter.setCacheSize (9);
.end script
-- 36/5 - 0 ---------------------------------------------------------------

.sort -a 2 -a 3
-- 36/6 - 0 ---------------------------------------------------------------
SELECT * FROM XmlTable ORDER BY a;
-- success --
a b           c
- ----------- -------
1 ?           ?
1 ?           ?
2 ?           ?
1 <a>1234</a> [1,2,3]
2 <a>1234</a> [1,2,3]
2 <a>1234</a> [1,2,3]
5 <a>1234</a> [1,2,3]
1 <a>1234</a> [2,3,4]
2 <a>1234</a> [2,3,4]
2 <a>1234</a> [2,3,4]
5 <a>1234</a> [2,3,4]
4 <a>123</a>  [2,3,4]
4 <a>123</a>  [2,3,4]
4 <a>12</a>   [2,3,4]
4 <a>12</a>   [2,3,4]
4 <a>1</a>    [2,3,4]
4 <a>1</a>    [2,3,4]
3 <a>2222</a> [1,2,3]
4 <a>22</a>   [2,3,4]
4 <a>22</a>   [2,3,4]
3 <a>3333</a> [2,3,4]
3 <a>4444</a> [1,2,3]
3 <a>5555</a> [2,3,4]
-- activity count = 23
-- 37/6 - 0 ---------------------------------------------------------------

DROP TABLE XmlTable;
-- success. update count = 0
-- 38/6 - 0 ---------------------------------------------------------------

.close
-- 38/7 - 0 ---------------------------------------------------------------

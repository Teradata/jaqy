Jaqy Console 1.0
-- 0/0 - 0 ----------------------------------------------------------------
--------------------------------------------------------------------------
-- test pipe
--------------------------------------------------------------------------

.run ../common/postgresql_setup.sql
-- Running script: ../common/postgresql_setup.sql
-- 0/1 - 0 ----------------------------------------------------------------
.open -u postgres postgresql://localhost/?stringtype=unspecified
-- 0/2 - 0 ----------------------------------------------------------------
CREATE TABLE XmlTable
(
	a  INTEGER,
	c1 XML
);
-- success. update count = 0
-- 1/2 - 0 ----------------------------------------------------------------

INSERT INTO XmlTable VALUES (1, '<abc>1</abc>');
-- success. update count = 1
-- 2/2 - 0 ----------------------------------------------------------------
INSERT INTO XmlTable VALUES (2, '<abc>12</abc>');
-- success. update count = 1
-- 3/2 - 0 ----------------------------------------------------------------
INSERT INTO XmlTable VALUES (3, '<abc>123</abc>');
-- success. update count = 1
-- 4/2 - 0 ----------------------------------------------------------------
INSERT INTO XmlTable VALUES (4, '<abc>1234</abc>');
-- success. update count = 1
-- 5/2 - 0 ----------------------------------------------------------------
INSERT INTO XmlTable VALUES (5, '<abc>12345</abc>');
-- success. update count = 1
-- 6/2 - 0 ----------------------------------------------------------------
INSERT INTO XmlTable VALUES (6, NULL);
-- success. update count = 1
-- 7/2 - 0 ----------------------------------------------------------------

CREATE TABLE XmlTable2
(
	a  INTEGER,
	c1 XML
);
-- success. update count = 0
-- 8/2 - 0 ----------------------------------------------------------------

-- same session pipe test for simplicity

.export pipe
-- 8/3 - 0 ----------------------------------------------------------------
.export
.export pipe
-- 8/4 - 0 ----------------------------------------------------------------
.fetchsize 2
-- 8/5 - 0 ----------------------------------------------------------------
SELECT * FROM XmlTable ORDER BY a;
-- success --
-- 9/5 - 0 ----------------------------------------------------------------
.import pipe
-- 9/6 - 0 ----------------------------------------------------------------
.import
.import pipe
-- 9/7 - 0 ----------------------------------------------------------------
.importschema
Column Type Nullable
------ ---- --------
a      int4 Yes
c1     xml  Yes
-- 9/8 - 0 ----------------------------------------------------------------
.batchsize 2
-- 9/9 - 0 ----------------------------------------------------------------
INSERT INTO XmlTable2 VALUES (?, ?);
-- 10/9 - 0 ---------------------------------------------------------------

SELECT * FROM XmlTable2 ORDER BY a;
-- success --
a c1
- ----
1 ?
2 ?
3 ?
4 ?
5 ?
6 ?
-- activity count = 6
-- 11/9 - 0 ---------------------------------------------------------------

DROP TABLE XmlTable;
-- success. update count = 0
-- 12/9 - 0 ---------------------------------------------------------------
DROP TABLE XmlTable2;
-- success. update count = 0
-- 13/9 - 0 ---------------------------------------------------------------
.close
-- 13/10 - 0 --------------------------------------------------------------
